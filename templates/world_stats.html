<!-- Day Counter -->
<div class="grid grid-cols-2 gap-4">

  <!-- Day Counter (CSV label embedded in SVG) -->
  <div class="mc-weather-panel">
    <div class="mc-day-counter">
      <svg viewBox="0 0 48 48" width="120" height="120" role="img" aria-label="Day {{.Stats.Day}}">
        <rect x="8" y="6" width="32" height="36" fill="#D4A574" rx="2" />
        <rect x="10" y="8" width="28" height="32" fill="#F5E6D3" />
        <rect x="6" y="6" width="4" height="36" fill="#8B4513" />
        <rect x="7" y="8" width="2" height="32" fill="#A0522D" />
        <line x1="14" y1="14" x2="34" y2="14" stroke="#D4A574" stroke-width="1" />
        <line x1="14" y1="18" x2="34" y2="18" stroke="#D4A574" stroke-width="1" />
        <line x1="14" y1="22" x2="34" y2="22" stroke="#D4A574" stroke-width="1" />
        <rect x="14" y="26" width="20" height="12" fill="#2a2a2a" rx="1" />
        <text x="24" y="11" font-size="6" fill="#2a2a2a" text-anchor="middle" dominant-baseline="middle" style="font-family: monospace; font-weight:700;">Day</text>
        <text x="24" y="32" font-size="8.5" fill="#ffffff" text-anchor="middle" dominant-baseline="middle" style="font-family: monospace; font-weight:700;">{{.Stats.Day}}</text>
      </svg>
    </div>
  </div>
  <!-- Difficulty Indicator -->
  <div class="mc-weather-panel">
    <span class="label">Difficulty</span>
    <div>
      <form hx-post="/world/difficulty" hx-target="#world-stats" hx-swap="innerHTML"
            class="difficulty-form"
            style="width:100%; display:flex; flex-direction:column; align-items:stretch; gap:var(--space-2);">
        <select id="difficulty-select" name="difficulty" class="mc-select" style="width:100%;">
          <option value="peaceful" {{if eq .Stats.Difficulty "peaceful"}}selected{{end}}>Peaceful</option>
          <option value="easy" {{if eq .Stats.Difficulty "easy"}}selected{{end}}>Easy</option>
          <option value="normal" {{if eq .Stats.Difficulty "normal"}}selected{{end}}>Normal</option>
          <option value="hard" {{if eq .Stats.Difficulty "hard"}}selected{{end}}>Hard</option>
        </select>
        <button type="submit" class="mc-btn" style="width:100%;">Set</button>
      </form>
    </div>
  </div>

  <!-- Weather panel (full width) -->
  <div class="col-span-full mt-4 mc-weather-panel">
    <span class="label">Weather</span>

    <!-- icons row (centered) -->
    <div class="weather-icons" role="tablist" aria-label="Weather options">
      <button type="button" data-weather="clear" class="mc-btn mc-btn--ghost mc-btn--small" title="Clear">‚òÄÔ∏è</button>
      <button type="button" data-weather="rain" class="mc-btn mc-btn--ghost mc-btn--small" title="Rain">üåßÔ∏è</button>
      <button type="button" data-weather="thunder" class="mc-btn mc-btn--ghost mc-btn--small" title="Thunder">‚õàÔ∏è</button>
    </div>

    <form id="weather-form" hx-post="/world/weather" hx-target="#world-stats" hx-swap="innerHTML" class="weather-controls">
      <input type="hidden" name="weather" id="weather-value" />
      <div class="weather-controls-row">
        <button type="button" data-weather-action="clear" class="mc-btn">Clear</button>
        <input type="number" name="duration" class="mc-input weather-duration" placeholder="Duration (sec)" min="0" />
        <button type="submit" class="mc-btn">Set Weather</button>
      </div>
    </form>

    <script>
      (function(){
        var form = document.getElementById('weather-form');
        if (!form) return;
        var hidden = document.getElementById('weather-value');
        var iconButtons = document.querySelectorAll('.weather-icons button[data-weather]');
        var actionClear = form.querySelector('[data-weather-action="clear"]');

        function clearActiveIcons(){ iconButtons.forEach(function(b){ b.classList.remove('active'); }); }

        iconButtons.forEach(function(btn){
          btn.addEventListener('click', function(e){
            e.preventDefault();
            var value = btn.getAttribute('data-weather');
            clearActiveIcons();
            btn.classList.add('active');
            hidden.value = value;
          });
        });

        // clicking the left big "Clear" control should select clear but not submit
        if (actionClear) {
          actionClear.addEventListener('click', function(e){
            e.preventDefault();
            hidden.value = 'clear';
            clearActiveIcons();
            // mark the clear icon active too
            var clearIcon = document.querySelector('.weather-icons button[data-weather="clear"]');
            if (clearIcon) clearIcon.classList.add('active');
          });
        }

        // guard submit: require a selected weather
        form.addEventListener('submit', function(e){
          if (!hidden.value) {
            e.preventDefault();
            alert('Please choose a weather option before setting the weather.');
          }
        });
      })();
    </script>
  </div>

</div>
