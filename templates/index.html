<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css" />
    <title>Minecraft Admin Tool</title>
  </head>
  <body>
    <header class="flex items-center justify-end gap-4">
      {{if .User}}
      <div class="flex items-center gap-3 text-sm">
        <img
          src="{{.User.AvatarURL}}"
          alt="{{.User.Username}}"
          class="player-avatar"
        />
        <div class="text-right">
          <p class="font-semibold">{{.User.Username}}</p>
        </div>
      </div>
      <form method="post" action="/auth/logout">
        <button type="submit" class="mc-btn">Log out</button>
      </form>
      {{end}}
    </header>
    <div class="container grid-layout">
      <aside class="mc-box flex flex-col gap-4">
        <div>
          <p class="text-xs uppercase tracking-wide text-muted">Control</p>
          <h1 class="mt-2">{{.ServerName}}</h1>
          <p class="text-sm mt-2 text-muted">{{.ServerDescription}}</p>
        </div>
        <nav class="flex flex-col gap-2">
          <button
            type="button"
            data-nav="overview"
            class="mc-btn w-full"
            onclick="window.location.href='/'"
          >
            Overview
          </button>
          <button
            type="button"
            data-nav="whitelist"
            class="mc-btn w-full"
            hx-get="/whitelist"
            hx-target="#subpage-panel"
            hx-swap="innerHTML"
            hx-push-url="true"
          >
            Whitelist
          </button>
          <button
            type="button"
            data-nav="console"
            class="mc-btn w-full"
            hx-get="/rcon"
            hx-target="#subpage-panel"
            hx-swap="innerHTML"
            hx-push-url="true"
          >
            Server Console
          </button>
        </nav>
      </aside>
      <main class="flex flex-col gap-4">
        <section
          class="mc-box grid-layout"
          style="grid-template-columns: repeat(3, 1fr); gap: 1rem"
        >
          <div>
            <p class="text-xs uppercase tracking-wide text-muted">Address</p>
            <p class="mt-2">{{.ServerHost}}</p>
          </div>
          <div>
            <p class="text-xs uppercase tracking-wide text-muted">Game Port</p>
            <p class="mt-2">{{.ServerPort}}</p>
          </div>
          <div>
            <p class="text-xs uppercase tracking-wide text-muted">Version</p>
            <p class="mt-2">{{.ServerVersion}}</p>
          </div>
        </section>

        <section>
          <div
            id="player-list"
            hx-get="/server-info"
            hx-trigger="load, every 10s"
            hx-swap="innerHTML"
            class="mc-box"
          >
            <header
              class="mb-4"
              style="background: none; border: none; padding: 0"
            >
              <p class="text-xs uppercase tracking-wide text-muted">
                Live Players
              </p>
              <h2 class="mt-2">Online Right Now</h2>
            </header>
            <p class="text-sm">Loading player list...</p>
          </div>
        </section>
        <section>
          <div id="subpage-panel" class="flex flex-col">
            {{if eq .ActiveModule "whitelist"}} {{template "whitelist.html" .}}
            {{else if eq .ActiveModule "rcon"}} {{template
            "command_console.html" .}} {{else}} {{end}}
          </div>
        </section>
      </main>
    </div>

    <div id="modal-root"></div>

    <script>
      const navButtons = document.querySelectorAll("[data-nav]");
      const subpagePanel = document.getElementById("subpage-panel");
      const defaultPanelContent = subpagePanel ? subpagePanel.innerHTML : "";
      const removeModal = () => {
        const modal = document.getElementById("kick-modal");
        if (modal) {
          modal.remove();
        }
      };

      navButtons.forEach((button) => {
        button.addEventListener("click", () => {
          // Reset all buttons (optional visual feedback logic can go here)
          if (subpagePanel && button.dataset.nav === "overview") {
            subpagePanel.innerHTML = defaultPanelContent;
          }
        });
      });

      document.body.addEventListener("click", (event) => {
        if (event.target?.dataset?.closeModal === "kick") {
          removeModal();
        }
      });
      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          removeModal();
        }
      });
    </script>
  </body>
</html>
